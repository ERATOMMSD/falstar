(define-system
  AFC
  	(simulink "src/test/simulink/fuel_control.slx")

  	(parameters fuel_inj_tol MAF_sensor_tol AF_sensor_tol pump_tol kappa_tol tau_ww_tol fault_time kp ki)
  	(inputs throttle engine)
  	(outputs AFref AF mode mu rms)
  	
  	(piecewise-constant throttle 0 81.2)
  	(constant engine 900 1100)
  	
  	(constant fuel_inj_tol   1)
  	(constant MAF_sensor_tol 1)
  	(constant AF_sensor_tol  1)
  	(constant pump_tol       1)
  	(constant kappa_tol      1)
  	(constant tau_ww_tol     1)
  	(constant fault_time    60)
  	(constant kp 0.04)
  	(constant ki 0.14))

(define
  rise (and (< throttle 8.8)
            (eventually (0 0.05) (> throttle 40))))

(define
  fall (and (> throttle 40)
            (eventually (0 0.05) (< throttle 8.8))))

(define normal (== mode 0))
(define power  (== mode 1))

(define AFC26_easy (always (11 50) (< (abs mu) 0.02)))
(define AFC26_mid  (always (11 50) (< (abs mu) 0.04)))
(define AFC26_hard (always (11 50) (< (abs mu) 0.05)))

(define AFC27
  (always (11 50)
    (implies (or rise fall)
             (always (1 5) (< (abs mu) 0.008)))))

(define AFC29
  (always (49 50) (< rms 0.05)))

(define AFC32
  (always (11 50)
    (implies (and power (eventually (0 0.1) normal))
             (always (1 5) (< (abs mu) 0.02)))))

(define AFC33
  (always (11 50) (< (abs mu) 0.2)))
