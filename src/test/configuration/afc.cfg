(define-system
  AFC
  	(simulink "src/test/simulink/fuel_control.slx")
  	(inputs
  	  (throttle 0 81.2)
  	  (engine 900 1100))
  	(outputs
  	  (AFref)
  	  (AF)
  	  (mode)
  	  (mu)     ; NOTE: model includes two additional outputs for normalized AF ratio
  	  (rms))   ;       and the accumulated root mean square error
  	(vars
  	  (fuel_inj_tol   1)
  	  (MAF_sensor_tol 1)
  	  (AF_sensor_tol  1)
  	  (pump_tol       1)
  	  (kappa_tol      1)
  	  (tau_ww_tol     1)
  	  (fault_time    50)
  	  (kp 0.04)
  	  (ki 0.14)))

(define-system
  AFCnormal
  	(simulink "src/test/simulink/fuel_control.slx")
  	(inputs
  	  (throttle 0 61.1)
  	  (engine 900 1100))
  	(outputs
  	  (AFref)
  	  (AF)
  	  (mode)
  	  (mu)
  	  (rms))
  	(vars
  	  (fuel_inj_tol   1)
  	  (MAF_sensor_tol 1)
  	  (AF_sensor_tol  1)
  	  (pump_tol       1)
  	  (kappa_tol      1)
  	  (tau_ww_tol     1)
  	  (fault_time    50)
  	  (kp 0.04)
  	  (ki 0.14)))

(define-system
  AFCpower
  	(simulink "src/test/simulink/fuel_control.slx")
  	(inputs
  	  (throttle 62.2 81.2)
  	  (engine 900 1100))
  	(outputs
  	  (AFref)
  	  (AF)
  	  (mode)
  	  (mu)
  	  (rms))
  	(vars
  	  (fuel_inj_tol   1)
  	  (MAF_sensor_tol 1)
  	  (AF_sensor_tol  1)
  	  (pump_tol       1)
  	  (kappa_tol      1)
  	  (tau_ww_tol     1)
  	  (fault_time    50)
  	  (kp 0.04)
  	  (ki 0.14)))

(define
  rise (and (< throttle 1)
            (eventually (0 0.1) (> throttle 40))))

(define
  fall (and (> throttle 40)
            (eventually (0 0.1) (< throttle 1))))

(define normal (== mode 0))
(define power  (== mode 1))

(define AFC26_easy (always (11 50) (< (abs mu) 0.02)))
(define AFC26_mid  (always (11 50) (< (abs mu) 0.04)))
(define AFC26_hard (always (11 50) (< (abs mu) 0.05)))

(define AFC27
  (always (11 50)
    (implies (or rise fall)
             (always (1 5) (< (abs mu) 0.008)))))

(define AFC29
  (always (49 50) (< rms 0.05)))

(define AFC32
  (always (11 50)
    (implies (and power (eventually (0 0.1) normal))
             (always (1 5) (< (abs mu) 0.02)))))

(define AFC33
  (always (11 50) (< (abs mu) 0.2)))
  
  